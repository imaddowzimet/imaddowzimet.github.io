# Interpolate
datafull.ts.interp <- na.interpolation(datafull.ts, option="spline")
test <- as.data.frame(datafull.ts.interp)
# Change a few column names for legend purposes
colnames(test)[c(4,10,11)] <- c("Implant/Lunelle/patch","Rhythm", "Natural family planning")
# Define colors
legendcolors <- c("#4f114c","#821c7e","#1b5c82", "#21821b",
"#1a6b15", "#145110", "#0d380b", "#eded2a",
"#efcc2d", "#772514", "#ad361f",
"#e21f1f","#a09292")
par(oma=c(0,0,1,11))
stackpoly(test, stack=TRUE, ylim=c(0,100), xaxlab = seq(1982,2012,1), col=legendcolors, axis4 = FALSE)
legend(32, 100, legend=rev(colnames(test)), fill=rev(legendcolors),
xpd=NA, horiz=FALSE, cex=1.1, bty='n',
title=expression(bold("Method")) , title.adj=0.04, y.intersp=1.3)
mtext(expression(bold(" Contraceptive method mix among contraceptive users \n aged 15-44, 1982-2012")), outer=TRUE, line=-1.9, adj=.55, cex=1.2)
abline(v=c(7,14,27), lty=3, lwd=2)
# Still need to do:
# Write text. Play around with overall size.  See if there are age specific versions of this table.
knitr::opts_chunk$set(echo = TRUE)
########################
# SET-UP
#######################
library(ggplot2)
library(readxl)
library(reshape2)
library(plyr)
library(plotrix)
library(imputeTS)
# Load data
data <- as.data.frame(read_xls("/Users/isaacmaddowzimet/imaddowzimet.github.io/method mix 1982-2012.xls", sheet="Recode 1"))
# Change NAs to 0s
data[is.na(data)] <- 0
# Reshape
#datalong <- melt(data, "Method")
#datalong <- rename(datalong, c("variable"="year", "value"="percent"))
#datalong <- datalong[order(datalong$Method),]
#datawide <- dcast(datalong, "year")
# Rescale to sum to 100
data.stand <- data
standardize <- function(x) {x*(100/sum(x))}
data.stand[,-1] <- sapply(data.stand[,-1], standardize)
# Store the names
n <- data.stand$Method
datatranspose <- as.data.frame(t(data.stand[,-1]))
colnames(datatranspose) <- n
# Interpolate: haven't quite figured this one out
# I bet it involves approxfun and lapply (to do by group)
x <- setdiff(1982:2012, c(1982,1988,1995,2008,2012))
extrarows <- matrix(NA, length(x), dim(datatranspose)[2])
rownames(extrarows) <- x
colnames(extrarows) <- n
datafull <- rbind(datatranspose, extrarows)
# Order by rownames
datafull <- datafull[order(row.names(datafull)),]
datafull.ts <- ts(datafull,start=1982)
# Interpolate
datafull.ts.interp <- na.interpolation(datafull.ts, option="spline")
test <- as.data.frame(datafull.ts.interp)
# Change a few column names for legend purposes
colnames(test)[c(4,10,11)] <- c("Implant/Lunelle/patch","Rhythm", "Natural family planning")
# Define colors
legendcolors <- c("#4f114c","#821c7e","#1b5c82", "#21821b",
"#1a6b15", "#145110", "#0d380b", "#eded2a",
"#efcc2d", "#772514", "#ad361f",
"#e21f1f","#a09292")
par(oma=c(0,0,1,11))
stackpoly(test, stack=TRUE, ylim=c(0,100), xaxlab = seq(1982,2012,1), col=legendcolors, axis4 = FALSE)
legend(32, 100, legend=rev(colnames(test)), fill=rev(legendcolors),
xpd=NA, horiz=FALSE, cex=1.1, bty='n',
title=expression(bold("Method")) , title.adj=0.05, y.intersp=1.3)
mtext(expression(bold(" Contraceptive method mix among contraceptive users \n aged 15-44, 1982-2012")), outer=TRUE, line=-1.9, adj=.55, cex=1.2)
abline(v=c(7,14,27), lty=3, lwd=2)
# Still need to do:
# Write text. Play around with overall size.  See if there are age specific versions of this table.
knitr::opts_chunk$set(echo = TRUE)
########################
# SET-UP
#######################
library(ggplot2)
library(readxl)
library(reshape2)
library(plyr)
library(plotrix)
library(imputeTS)
# Load data
data <- as.data.frame(read_xls("/Users/isaacmaddowzimet/imaddowzimet.github.io/method mix 1982-2012.xls", sheet="Recode 1"))
# Change NAs to 0s
data[is.na(data)] <- 0
# Reshape
#datalong <- melt(data, "Method")
#datalong <- rename(datalong, c("variable"="year", "value"="percent"))
#datalong <- datalong[order(datalong$Method),]
#datawide <- dcast(datalong, "year")
# Rescale to sum to 100
data.stand <- data
standardize <- function(x) {x*(100/sum(x))}
data.stand[,-1] <- sapply(data.stand[,-1], standardize)
# Store the names
n <- data.stand$Method
datatranspose <- as.data.frame(t(data.stand[,-1]))
colnames(datatranspose) <- n
# Interpolate: haven't quite figured this one out
# I bet it involves approxfun and lapply (to do by group)
x <- setdiff(1982:2012, c(1982,1988,1995,2008,2012))
extrarows <- matrix(NA, length(x), dim(datatranspose)[2])
rownames(extrarows) <- x
colnames(extrarows) <- n
datafull <- rbind(datatranspose, extrarows)
# Order by rownames
datafull <- datafull[order(row.names(datafull)),]
datafull.ts <- ts(datafull,start=1982)
# Interpolate
datafull.ts.interp <- na.interpolation(datafull.ts, option="spline")
test <- as.data.frame(datafull.ts.interp)
# Change a few column names for legend purposes
colnames(test)[c(4,10,11)] <- c("Implant/Lunelle/patch","Rhythm", "Natural family planning")
# Define colors
legendcolors <- c("#4f114c","#821c7e","#1b5c82", "#21821b",
"#1a6b15", "#145110", "#0d380b", "#eded2a",
"#efcc2d", "#772514", "#ad361f",
"#e21f1f","#a09292")
par(oma=c(0,0,1,11))
stackpoly(test, stack=TRUE, ylim=c(0,100), xaxlab = seq(1982,2012,1), col=legendcolors, axis4 = FALSE)
legend(32, 100, legend=rev(colnames(test)), fill=rev(legendcolors),
xpd=NA, horiz=FALSE, cex=1.1, bty='n',
title=expression(bold("Method")) , title.adj=0.08, y.intersp=1.3)
mtext(expression(bold(" Contraceptive method mix among contraceptive users \n aged 15-44, 1982-2012")), outer=TRUE, line=-1.9, adj=.55, cex=1.2)
abline(v=c(7,14,27), lty=3, lwd=2)
# Still need to do:
# Write text. Play around with overall size.  See if there are age specific versions of this table.
knitr::opts_chunk$set(echo = TRUE)
########################
# SET-UP
#######################
library(ggplot2)
library(readxl)
library(reshape2)
library(plyr)
library(plotrix)
library(imputeTS)
# Load data
data <- as.data.frame(read_xls("/Users/isaacmaddowzimet/imaddowzimet.github.io/method mix 1982-2012.xls", sheet="Recode 1"))
# Change NAs to 0s
data[is.na(data)] <- 0
# Reshape
#datalong <- melt(data, "Method")
#datalong <- rename(datalong, c("variable"="year", "value"="percent"))
#datalong <- datalong[order(datalong$Method),]
#datawide <- dcast(datalong, "year")
# Rescale to sum to 100
data.stand <- data
standardize <- function(x) {x*(100/sum(x))}
data.stand[,-1] <- sapply(data.stand[,-1], standardize)
# Store the names
n <- data.stand$Method
datatranspose <- as.data.frame(t(data.stand[,-1]))
colnames(datatranspose) <- n
# Interpolate: haven't quite figured this one out
# I bet it involves approxfun and lapply (to do by group)
x <- setdiff(1982:2012, c(1982,1988,1995,2008,2012))
extrarows <- matrix(NA, length(x), dim(datatranspose)[2])
rownames(extrarows) <- x
colnames(extrarows) <- n
datafull <- rbind(datatranspose, extrarows)
# Order by rownames
datafull <- datafull[order(row.names(datafull)),]
datafull.ts <- ts(datafull,start=1982)
# Interpolate
datafull.ts.interp <- na.interpolation(datafull.ts, option="spline")
test <- as.data.frame(datafull.ts.interp)
# Change a few column names for legend purposes
colnames(test)[c(4,10,11)] <- c("Implant/Lunelle/patch","Rhythm", "Natural family planning")
# Define colors
legendcolors <- c("#4f114c","#821c7e","#1b5c82", "#21821b",
"#1a6b15", "#145110", "#0d380b", "#eded2a",
"#efcc2d", "#772514", "#ad361f",
"#e21f1f","#a09292")
par(oma=c(0,0,1,11))
stackpoly(test, stack=TRUE, ylim=c(0,100), xaxlab = seq(1982,2012,1), col=legendcolors, axis4 = FALSE)
legend(32, 100, legend=rev(colnames(test)), fill=rev(legendcolors),
xpd=NA, horiz=FALSE, cex=1.1, bty='n',
title=expression(bold("Method")) , title.adj=c(0.08, -.1), y.intersp=1.3)
mtext(expression(bold(" Contraceptive method mix among contraceptive users \n aged 15-44, 1982-2012")), outer=TRUE, line=-1.9, adj=.55, cex=1.2)
abline(v=c(7,14,27), lty=3, lwd=2)
# Still need to do:
# Write text. Play around with overall size.  See if there are age specific versions of this table.
knitr::opts_chunk$set(echo = TRUE)
########################
# SET-UP
#######################
library(ggplot2)
library(readxl)
library(reshape2)
library(plyr)
library(plotrix)
library(imputeTS)
# Load data
data <- as.data.frame(read_xls("/Users/isaacmaddowzimet/imaddowzimet.github.io/method mix 1982-2012.xls", sheet="Recode 1"))
# Change NAs to 0s
data[is.na(data)] <- 0
# Reshape
#datalong <- melt(data, "Method")
#datalong <- rename(datalong, c("variable"="year", "value"="percent"))
#datalong <- datalong[order(datalong$Method),]
#datawide <- dcast(datalong, "year")
# Rescale to sum to 100
data.stand <- data
standardize <- function(x) {x*(100/sum(x))}
data.stand[,-1] <- sapply(data.stand[,-1], standardize)
# Store the names
n <- data.stand$Method
datatranspose <- as.data.frame(t(data.stand[,-1]))
colnames(datatranspose) <- n
# Interpolate: haven't quite figured this one out
# I bet it involves approxfun and lapply (to do by group)
x <- setdiff(1982:2012, c(1982,1988,1995,2008,2012))
extrarows <- matrix(NA, length(x), dim(datatranspose)[2])
rownames(extrarows) <- x
colnames(extrarows) <- n
datafull <- rbind(datatranspose, extrarows)
# Order by rownames
datafull <- datafull[order(row.names(datafull)),]
datafull.ts <- ts(datafull,start=1982)
# Interpolate
datafull.ts.interp <- na.interpolation(datafull.ts, option="spline")
test <- as.data.frame(datafull.ts.interp)
# Change a few column names for legend purposes
colnames(test)[c(4,10,11)] <- c("Implant/Lunelle/patch","Rhythm", "Natural family planning")
# Define colors
legendcolors <- c("#4f114c","#821c7e","#1b5c82", "#21821b",
"#1a6b15", "#145110", "#0d380b", "#eded2a",
"#efcc2d", "#772514", "#ad361f",
"#e21f1f","#a09292")
par(oma=c(0,0,1,11))
stackpoly(test, stack=TRUE, ylim=c(0,100), xaxlab = seq(1982,2012,1), col=legendcolors, axis4 = FALSE)
legend(32, 100, legend=rev(colnames(test)), fill=rev(legendcolors),
xpd=NA, horiz=FALSE, cex=1.1, bty='n',
title=expression(bold("Method")) , title.adj=0.08, y.intersp=1.3)
mtext(expression(bold(" Contraceptive method mix among contraceptive users \n aged 15-44, 1982-2012")), outer=TRUE, line=-1.9, adj=.55, cex=1.2)
abline(v=c(7,14,27), lty=3, lwd=2)
# Still need to do:
# Write text. Play around with overall size.  See if there are age specific versions of this table.
?legend
knitr::opts_chunk$set(echo = TRUE)
########################
# SET-UP
#######################
library(ggplot2)
library(readxl)
library(reshape2)
library(plyr)
library(plotrix)
library(imputeTS)
# Load data
data <- as.data.frame(read_xls("/Users/isaacmaddowzimet/imaddowzimet.github.io/method mix 1982-2012.xls", sheet="Recode 1"))
# Change NAs to 0s
data[is.na(data)] <- 0
# Reshape
#datalong <- melt(data, "Method")
#datalong <- rename(datalong, c("variable"="year", "value"="percent"))
#datalong <- datalong[order(datalong$Method),]
#datawide <- dcast(datalong, "year")
# Rescale to sum to 100
data.stand <- data
standardize <- function(x) {x*(100/sum(x))}
data.stand[,-1] <- sapply(data.stand[,-1], standardize)
# Store the names
n <- data.stand$Method
datatranspose <- as.data.frame(t(data.stand[,-1]))
colnames(datatranspose) <- n
# Interpolate: haven't quite figured this one out
# I bet it involves approxfun and lapply (to do by group)
x <- setdiff(1982:2012, c(1982,1988,1995,2008,2012))
extrarows <- matrix(NA, length(x), dim(datatranspose)[2])
rownames(extrarows) <- x
colnames(extrarows) <- n
datafull <- rbind(datatranspose, extrarows)
# Order by rownames
datafull <- datafull[order(row.names(datafull)),]
datafull.ts <- ts(datafull,start=1982)
# Interpolate
datafull.ts.interp <- na.interpolation(datafull.ts, option="spline")
test <- as.data.frame(datafull.ts.interp)
# Change a few column names for legend purposes
colnames(test)[c(4,10,11)] <- c("Implant/Lunelle/patch","Rhythm", "Natural family planning")
# Define colors
legendcolors <- c("#4f114c","#821c7e","#1b5c82", "#21821b",
"#1a6b15", "#145110", "#0d380b", "#eded2a",
"#efcc2d", "#772514", "#ad361f",
"#e21f1f","#a09292")
par(oma=c(0,0,1,11))
stackpoly(test, stack=TRUE, ylim=c(0,100), xaxlab = seq(1982,2012,1), col=legendcolors, axis4 = FALSE)
legend(32, 100, legend=rev(colnames(test)), fill=rev(legendcolors),
xpd=NA, horiz=FALSE, cex=1.1, bty='n',
title=expression(bold("Method")) , title.adj=0.09, y.intersp=1.3)
mtext(expression(bold(" Contraceptive method mix among contraceptive users \n aged 15-44, 1982-2012")), outer=TRUE, line=-1.9, adj=.55, cex=1.2)
abline(v=c(7,14,27), lty=3, lwd=2)
# Still need to do:
# Write text. Play around with overall size.  See if there are age specific versions of this table.
knitr::opts_chunk$set(echo = TRUE)
########################
# SET-UP
#######################
library(readxl)
library(plotrix)
library(imputeTS)
# Load data
data <- as.data.frame(read_xls("/Users/isaacmaddowzimet/imaddowzimet.github.io/method mix 1982-2012.xls", sheet="Recode 1"))
# Change NAs to 0s (in some years, some methods didn't exist yet)
data[is.na(data)] <- 0
print(data)
# Rescale to sum to 100
data.stand <- data
standardize <- function(x) {x*(100/sum(x))}
data.stand[,-1] <- sapply(data.stand[,-1], standardize)
# Tranpose the data
n <- data.stand$Method                              # This just stores the method names, since we'll use them as column names later on
datatranspose <- as.data.frame(t(data.stand[,-1]))  # This transposes, excluding the method column
colnames(datatranspose) <- n                        # And this brings back in the column names (the methods)
# Print the data
print(datatranspose)
# Add extra years
x <- setdiff(1982:2012, c(1982,1988,1995,2002,2008,2012)) # the second argument excludes years we already have
extrarows <- matrix(NA, length(x), dim(datatranspose)[2]) # puts the list in a matrix
rownames(extrarows) <- x
colnames(extrarows) <- n
datafull <- rbind(datatranspose, extrarows)             # Appends it to our existing data
datafull <- datafull[order(row.names(datafull)),]       # Orders it by year
# Convert to time series
datafull.ts <- ts(datafull,start=1982)                  # It's that easy!
# Interpolate
datafull.ts.interp <- na.interpolation(datafull.ts, option="spline") # It's also that easy!
finaldata <- as.data.frame(datafull.ts.interp)
# Change a few column names for legend purposes
colnames(finaldata)[c(4,10,11)] <- c("Implant/Lunelle/patch","Rhythm", "Natural family planning")
# Define colors
legendcolors <- c("#4f114c","#821c7e","#1b5c82", "#21821b",
"#1a6b15", "#145110", "#0d380b", "#eded2a",
"#efcc2d", "#772514", "#ad361f",
"#e21f1f","#a09292")
par(oma=c(0,0,1,11))
stackpoly(finaldata, stack=TRUE, ylim=c(0,100), xaxlab = seq(1982,2012,1), col=legendcolors, axis4 = FALSE)
legend(32, 100, legend=rev(colnames(finaldata)), fill=rev(legendcolors),
xpd=NA, horiz=FALSE, cex=1.1, bty='n',
title=expression(bold("Method")) , title.adj=0.09, y.intersp=1.3)
mtext(expression(bold(" Contraceptive method mix among contraceptive users \n aged 15-44, 1982-2012")), outer=TRUE, line=-1.9, adj=.55, cex=1.2)
abline(v=c(7,14,27), lty=3, lwd=2)
# Still need to do:
# Write text. Play around with overall size.  See if there are age specific versions of this table.
datafull.ts.interp
knitr::opts_chunk$set(echo = TRUE)
########################
# SET-UP
#######################
library(readxl)
library(plotrix)
library(imputeTS)
# Load data
data <- as.data.frame(read_xls("/Users/isaacmaddowzimet/imaddowzimet.github.io/method mix 1982-2012.xls", sheet="Recode 1"))
# Change NAs to 0s (in some years, some methods didn't exist yet)
data[is.na(data)] <- 0
print(data)
# Rescale to sum to 100
data.stand <- data
standardize <- function(x) {x*(100/sum(x))}
data.stand[,-1] <- sapply(data.stand[,-1], standardize)
# Tranpose the data
n <- data.stand$Method                              # This just stores the method names, since we'll use them as column names later on
datatranspose <- as.data.frame(t(data.stand[,-1]))  # This transposes, excluding the method column
colnames(datatranspose) <- n                        # And this brings back in the column names (the methods)
# Print the data
print(datatranspose)
# Add extra years
x <- setdiff(1982:2012, c(1982,1988,1995,2002,2008,2012)) # the second argument excludes years we already have
extrarows <- matrix(NA, length(x), dim(datatranspose)[2]) # puts the list in a matrix
rownames(extrarows) <- x
colnames(extrarows) <- n
datafull <- rbind(datatranspose, extrarows)             # Appends it to our existing data
datafull <- datafull[order(row.names(datafull)),]       # Orders it by year
# Convert to time series
datafull.ts <- ts(datafull,start=1982)                  # It's that easy!
# Interpolate
datafull.ts.interp <- na.interpolation(datafull.ts, option="spline") # It's also that easy!
finaldata <- as.data.frame(datafull.ts.interp)
# Change a few column names for legend purposes
colnames(finaldata)[c(4,10,11)] <- c("Implant/Lunelle/patch","Rhythm", "Natural family planning")
# Define colors
legendcolors <- c("#4f114c","#821c7e","#1b5c82", "#21821b",
"#1a6b15", "#145110", "#0d380b", "#eded2a",
"#efcc2d", "#772514", "#ad361f",
"#e21f1f","#a09292")
par(oma=c(0,0,1,11))
stackpoly(finaldata, stack=TRUE, ylim=c(0,100), xaxlab = seq(1982,2012,1), col=legendcolors, axis4 = FALSE)
legend(32, 100, legend=rev(colnames(finaldata)), fill=rev(legendcolors),
xpd=NA, horiz=FALSE, cex=1.1, bty='n',
title=expression(bold("Method")) , title.adj=0.09, y.intersp=1.3)
mtext(expression(bold(" Contraceptive method mix among contraceptive users \n aged 15-44, 1982-2012")), outer=TRUE, line=-1.9, adj=.55, cex=1.2)
abline(v=c(7,14,27), lty=3, lwd=2)
# Still need to do:
# Write text. Play around with overall size.  See if there are age specific versions of this table.
knitr::opts_chunk$set(echo = TRUE)
########################
# SET-UP
#######################
library(readxl)
library(plotrix)
library(imputeTS)
# Load data
data <- as.data.frame(read_xls("/Users/isaacmaddowzimet/imaddowzimet.github.io/method mix 1982-2012.xls", sheet="Recode 1"))
# Change NAs to 0s (in some years, some methods didn't exist yet)
data[is.na(data)] <- 0
print(data)
# Rescale to sum to 100
data.stand <- data
standardize <- function(x) {x*(100/sum(x))}
data.stand[,-1] <- sapply(data.stand[,-1], standardize)
# Tranpose the data
n <- data.stand$Method                              # This just stores the method names, since we'll use them as column names later on
datatranspose <- as.data.frame(t(data.stand[,-1]))  # This transposes, excluding the method column
colnames(datatranspose) <- n                        # And this brings back in the column names (the methods)
# Print the data
print(datatranspose)
# Add extra years
x <- setdiff(1982:2012, c(1982,1988,1995,2002,2008,2012)) # the second argument excludes years we already have
extrarows <- matrix(NA, length(x), dim(datatranspose)[2]) # puts the list in a matrix
rownames(extrarows) <- x
colnames(extrarows) <- n
datafull <- rbind(datatranspose, extrarows)             # Appends it to our existing data
datafull <- datafull[order(row.names(datafull)),]       # Orders it by year
# Convert to time series
datafull.ts <- ts(datafull,start=1982)                  # It's that easy!
# Interpolate
datafull.ts.interp <- na.interpolation(datafull.ts, option="spline") # It's also that easy!
finaldata <- as.data.frame(datafull.ts.interp)
# Change a few column names for legend purposes
colnames(finaldata)[c(4,10,11)] <- c("Implant/Lunelle/patch","Rhythm", "Natural family planning")
# Define colors
legendcolors <- c("#4f114c","#821c7e","#1b5c82", "#21821b",
"#1a6b15", "#145110", "#0d380b", "#eded2a",
"#efcc2d", "#772514", "#ad361f",
"#e21f1f","#a09292")
par(oma=c(0,0,1,11))
stackpoly(finaldata, stack=TRUE, ylim=c(0,100), xaxlab = seq(1982,2012,1), col=legendcolors, axis4 = FALSE)
legend(32, 100, legend=rev(colnames(finaldata)), fill=rev(legendcolors),
xpd=NA, horiz=FALSE, cex=1.1, bty='n',
title=expression(bold("Method")) , title.adj=0.09, y.intersp=1.3)
mtext(expression(bold(" Contraceptive method mix among contraceptive users \n aged 15-44, 1982-2012")), outer=TRUE, line=-1.9, adj=.55, cex=1.2)
abline(v=c(7,14,21,27), lty=3, lwd=2)
# Still need to do:
# Write text. Play around with overall size.  See if there are age specific versions of this table.
xlab <- c(1982, , , , , ,1988)
xlab <- c(1982,NA,NA,NA,NA,NA,1988)
xlab
knitr::opts_chunk$set(echo = TRUE)
########################
# SET-UP
#######################
library(readxl)
library(plotrix)
library(imputeTS)
# Load data
data <- as.data.frame(read_xls("/Users/isaacmaddowzimet/imaddowzimet.github.io/method mix 1982-2012.xls", sheet="Recode 1"))
# Change NAs to 0s (in some years, some methods didn't exist yet)
data[is.na(data)] <- 0
print(data)
# Rescale to sum to 100
data.stand <- data
standardize <- function(x) {x*(100/sum(x))}
data.stand[,-1] <- sapply(data.stand[,-1], standardize)
# Tranpose the data
n <- data.stand$Method                              # This just stores the method names, since we'll use them as column names later on
datatranspose <- as.data.frame(t(data.stand[,-1]))  # This transposes, excluding the method column
colnames(datatranspose) <- n                        # And this brings back in the column names (the methods)
# Print the data
print(datatranspose)
# Add extra years
x <- setdiff(1982:2012, c(1982,1988,1995,2002,2008,2012)) # the second argument excludes years we already have
extrarows <- matrix(NA, length(x), dim(datatranspose)[2]) # puts the list in a matrix
rownames(extrarows) <- x
colnames(extrarows) <- n
datafull <- rbind(datatranspose, extrarows)             # Appends it to our existing data
datafull <- datafull[order(row.names(datafull)),]       # Orders it by year
# Convert to time series
datafull.ts <- ts(datafull,start=1982)                  # It's that easy!
# Interpolate
datafull.ts.interp <- na.interpolation(datafull.ts, option="spline") # It's also that easy!
# Convert it back to a data frame (because stackpoly doesn't like time series)
finaldata <- as.data.frame(datafull.ts.interp)
# Change a few column names for legend purposes
colnames(finaldata)[c(4,10,11)] <- c("Implant/Lunelle/patch","Rhythm", "Natural family planning")
# Define colors
legendcolors <- c("#4f114c","#821c7e","#1b5c82", "#21821b",
"#1a6b15", "#145110", "#0d380b", "#eded2a",
"#efcc2d", "#772514", "#ad361f",
"#e21f1f","#a09292")
# Put some extra space on the right side for the big legend
par(oma=c(0,0,1,11))
# Only add x-axis labels for years we have data for
xlab <- c(1982,NA,NA,NA,NA,NA,1988,NA,NA,NA,NA,NA,NA,
1995,NA,NA,NA,NA,NA,NA,2002,NA,NA,NA,NA,NA,2008,
NA,NA,NA,2012)
# Plot!
stackpoly(finaldata, stack=TRUE, ylim=c(0,100), xaxlab = xlab, col=legendcolors, axis4 = FALSE)
# Add legend!
legend(32, 100, legend=rev(colnames(finaldata)), fill=rev(legendcolors),
xpd=NA, horiz=FALSE, cex=1.1, bty='n',
title=expression(bold("Method")) , title.adj=0.09, y.intersp=1.3)
# Add title!
mtext(expression(bold(" Contraceptive method mix among contraceptive users \n aged 15-44, 1982-2012")), outer=TRUE, line=-1.9, adj=.55, cex=1.2)
# Add dotted lines for actual data
abline(v=c(7,14,21,27), lty=3, lwd=2)
